<app-navbar></app-navbar>
<div class="container mt-4 ">
  <!-- Botón "Volver atrás" -->
  <button class="btn btn-danger mb-3" [routerLink]="['/home']">
    <i class="fas fa-arrow-left"></i> Volver atrás
  </button>

  <!-- Título principal -->
  <h3 class="text-center mb-4 text-black">Costeo de hormigones</h3>
  <h4></h4>
  <div class="row">
    <!-- Columna izquierda -->
    <div class="col-md-6">
      <div class="card shadow p-4 fade-in">
        <h5 class="mb-3">Seleccione planta:</h5>
        <!-- Botones de planta -->
        <div class="plantas-grid mb-4">
          <button
            class="planta-btn"
            *ngFor="let planta of plantas"
            [class.active]="plantaSeleccionada === planta.id"
            (click)="seleccionarPlanta(planta.id)"
          >
            {{ planta.nombre }}
          </button>
        </div>

        <!-- Input para el producto y botón de costeo -->
        <div *ngIf="plantaSeleccionada">
          <h5>
            Costear producto en planta: <span class="text-highlight">{{ nombrePlantaSeleccionada }}</span>
          </h5>
          <div class="input-group mt-3 mb-3">
            <span class="input-group-text">
              <i class="fas fa-barcode"></i>
            </span>
            <input
              type="number"
              class="form-control"
              [(ngModel)]="idProducto"
              placeholder="Ingresa el ID del producto"
            />
          </div>
          <button class="btn btn-success w-100 bounce-on-hover" (click)="costearProducto()">
            <i class="fas fa-calculator"></i> Costear Producto
          </button>
        </div>
      </div>
    </div>

    <!-- Columna derecha -->
    <div class="col-md-6">
      <!-- Tarjeta de resultados -->
      <div *ngIf="dosificacion" class="card shadow p-4 fade-in">
        <h5 class="mb-3">
          Dosificación para el hormigon {{ idProducto }} en {{ nombrePlantaSeleccionada }}
        </h5>
        <div class="table-responsive">
          <table class="table table-bordered">
            <thead class="table-light">
              <tr>
                <th>Cemento</th>
                <th>Agua Total</th>
                <th>Arena</th>
                <th>Gravilla</th>
                <th *ngIf="dosificacion.aditivo1 !== 0">Aditivo 1 (Base)</th>
                <th *ngIf="dosificacion.aditivo2 !== 0">Aditivo 2</th>
                <th *ngIf="dosificacion.aditivo3 !== 0">Aditivo 3</th>
                <th *ngIf="dosificacion.aditivo4 !== 0">Aditivo 4</th>
                <th *ngIf="dosificacion.aditivo5 !== 0">Aditivo 5</th>
                <th>Descripción</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>{{ dosificacion.cemento }}</td>
                <td>{{ dosificacion.aguaTotal }}</td>
                <td>{{ dosificacion.arena }}</td>
                <td>{{ dosificacion.gravilla }}</td>
                <td *ngIf="dosificacion.aditivo1 !== 0">{{ dosificacion.aditivo1 }}</td>
                <td *ngIf="dosificacion.aditivo2 !== 0">{{ dosificacion.aditivo2 }}</td>
                <td *ngIf="dosificacion.aditivo3 !== 0">{{ dosificacion.aditivo3 }}</td>
                <td *ngIf="dosificacion.aditivo4 !== 0">{{ dosificacion.aditivo4 }}</td>
                <td *ngIf="dosificacion.aditivo5 !== 0">{{ dosificacion.aditivo5 }}</td>
                <td>{{ dosificacion.descripcion }}</td>
              </tr>
            </tbody>
          </table>


        </div>

        <!-- Detalles del cálculo de costeo -->
        <h5 class="mt-4">Detalles del costeo</h5>
        <ul class="list-group">
          <li class="list-group-item">
            <strong>Costo Final:</strong>
            <span class="float-end">{{ costoFinal | number : "1.2-2" }} UF</span>
          </li>
          <button
            class="btn btn-primary mt-3 w-100 bounce-on-hover"
            (click)="toggleDetalles()"
          >
            {{ mostrarDetalles ? 'Ver menos' : 'Ver más' }}
          </button>
          <div *ngIf="mostrarDetalles">
            <li class="list-group-item">
              <strong>Costo Cemento:</strong>
              <span class="float-end">{{ costoCemento | number : "1.2-2" }} UF</span>
            </li>
            <li class="list-group-item">
              <strong>Costo Agua:</strong>
              <span class="float-end">{{ costoAgua | number : "1.2-2" }} UF</span>
            </li>
            <li class="list-group-item">
              <strong>Costo Arena:</strong>
              <span class="float-end">{{ costoArena | number : "1.2-2" }} UF</span>
            </li>
            <li class="list-group-item">
              <strong>Costo Gravilla:</strong>
              <span class="float-end">{{ costoGravilla | number : "1.2-2" }} UF</span>
            </li>
          </div>
        </ul>
      </div>

      <!-- Mensaje si no se encuentra dosificación -->
      <div
        *ngIf="!dosificacion && idProducto"
        class="alert alert-warning mt-4 shake"
      >
        No se encontró la dosificación para este producto en la planta seleccionada.
      </div>
    </div>
  </div>
</div>


